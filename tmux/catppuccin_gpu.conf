# GPU status module for Catppuccin tmux theme
# Shows GPU utilization with dynamic colors based on usage

# GPU icon and colors
set -ogq "@catppuccin_gpu_icon" "ó°¢® "
set -ogqF "@catppuccin_gpu_color" "#{E:@thm_blue}"

# GPU color logic based on usage (similar to CPU module)
%hidden MODULE_NAME="gpu"

set -ogq "@catppuccin_gpu_low_threshold" "25"
set -ogq "@catppuccin_gpu_medium_threshold" "50"
set -ogq "@catppuccin_gpu_high_threshold" "80"

# Dynamic GPU colors based on usage
set -gF "@gpu_percentage" "#(gpuinfo -p 2>/dev/null || echo '0')"

# Color determination logic
if-shell '[ "#{@gpu_percentage}" -lt "#{@catppuccin_gpu_low_threshold}" ]' \
    "set -gqF gpu_fg_color '#{E:@thm_fg}'; set -gqF gpu_bg_color '#{E:@thm_surface_0}'" \
    "if-shell '[ \"#{@gpu_percentage}\" -lt \"#{@catppuccin_gpu_medium_threshold}\" ]' \
        \"set -gqF gpu_fg_color '#{E:@thm_fg}'; set -gqF gpu_bg_color '#{E:@thm_yellow}'\" \
        \"if-shell '[ \\\"#{@gpu_percentage}\\\" -lt \\\"#{@catppuccin_gpu_high_threshold}\\\" ]' \
            \\\"set -gqF gpu_fg_color '#{E:@thm_crust}'; set -gqF gpu_bg_color '#{E:@thm_peach}'\\\" \
            \\\"set -gqF gpu_fg_color '#{E:@thm_crust}'; set -gqF gpu_bg_color '#{E:@thm_red}'\\\"\""

# Status text configuration
set -ogq "@catppuccin_status_gpu_text_fg" "#{l:#{gpu_fg_color}}"
set -ogq "@catppuccin_status_gpu_text_bg" "#{l:#{gpu_bg_color}}"
set -ogq "@catppuccin_gpu_text" " #{@gpu_percentage}%"

# Module formatting
set -ogqF "@catppuccin_status_gpu" "#{E:@catppuccin_status_module_left_separator}#[fg=#{E:@catppuccin_status_gpu_text_fg},bg=#{E:@catppuccin_status_gpu_text_bg}]#{E:@catppuccin_gpu_icon}#{E:@catppuccin_gpu_text}#[fg=#{E:@catppuccin_status_gpu_text_bg}]#{E:@catppuccin_status_module_right_separator}"